<div class="row post-detail-container my-4">
    
    <div class="col-md-7">
        
        <h1 class="mb-4">ÊäïÁ®øË©≥Á¥∞</h1>
        
        <div class="video-player-area mb-4 rounded shadow-sm bg-dark">
            <% if @post.video.attached? %>
                <%# @post.video.attached? „ÅØActive Storage„ÇíÊÉ≥ÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô %>
                <video controls class="w-100" style="max-height: 450px; object-fit: contain;">
                    <source src="<%= url_for(@post.video) %>" type="<%= @post.video.content_type %>">
                    „Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÂãïÁîª„Çø„Ç∞„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
                </video>
            <% else %>
                <div class="p-5 text-center text-white">
                    <i class="fas fa-video fa-3x mb-3"></i>
                    <p class="mb-0">ÂãïÁîª„Éï„Ç°„Ç§„É´„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                </div>
            <% end %>
        </div>

        <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
            <h5 class="mb-0">ÊäïÁ®øËÄÖ: <%= link_to @post.user.name, user_path(@post.user) %></h5>
            
            <%# üëç „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥„Å®„Ç´„Ç¶„É≥„Éà„ÅÆÁµ±Âêà %>
            <div class="d-flex align-items-center">
                <span class="badge bg-danger p-2 me-2">‚ù§Ô∏è <%= @post.likes.count %></span>
                <% if user_signed_in? %> 
                    <% if current_user.already_liked?(@post) %>
                        <%= link_to 'Ëß£Èô§', post_likes_path(@post), method: :delete, data: { remote: true }, class: 'btn btn-sm btn-secondary' %>
                    <% else %>
                        <%= link_to '„ÅÑ„ÅÑ„Å≠ÔºÅ', post_likes_path(@post), method: :post, data: { remote: true }, class: 'btn btn-sm btn-danger' %>
                    <% end %>
                <% end %>
            </div>
        </div>

        <div class="card p-3 mb-4 post-content-area shadow-sm">
            <h6 class="card-subtitle mb-2 text-muted">ÊÑèÂõ≥„Åó„Å¶„ÅÑ„Çã„Éù„Ç§„É≥„Éà</h6>
            <p class="card-text"><%= simple_format(@post.content) %></p>
        </div>
        
        <%# üåü Á∑®ÈõÜ„ÉªÂâäÈô§„Éú„Çø„É≥ (ÊäïÁ®øËÄÖ„ÅÆ„Åø) üåü %>
        <div class="mb-4">
            <% if current_user == @post.user %>
                <%= link_to 'Á∑®ÈõÜ', edit_post_path(@post), class: 'btn btn-warning me-2' %>
                <%= link_to 'ÂâäÈô§', post_path(@post), 
                            method: :delete, 
                            data: { confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü' },
                            class: 'btn btn-danger btn-sm' %>
            <% end %>
            <%= link_to '‰∏ÄË¶ß„Å´Êàª„Çã', posts_path, class: 'btn btn-outline-secondary ms-auto' %>
        </div>
    </div>

    <div class="col-md-5">
        
        <h3 class="mt-2">üí¨ „Ç≥„É°„É≥„Éà (<%= @post.comments.count %>‰ª∂)</h3>
        <hr>
        
        <% if user_signed_in? %>
            <%# local: false (AjaxÂåñ„ÅÆÊ∫ñÂÇô) „Å´Â§âÊõ¥„Åô„Çã„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô %>
            <%= form_with(model: [@post, Comment.new], local: true, class: "mb-4") do |form| %>
                <div class="form-group">
                    <%= form.text_area :content, rows: 3, class: "form-control", placeholder: "„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ..." %>
                </div>
                <%= form.submit "„Ç≥„É°„É≥„ÉàÊäïÁ®ø", class: "btn btn-success btn-block mt-2" %>
            <% end %>
        <% end %>
        
        <div id="comments-area" class="mt-4">
            <% @post.comments.includes(:user).order(created_at: :asc).each do |comment| %>
                <div class="card mb-2 comment-card shadow-sm">
                    <div class="card-body p-3">
                        <p class="card-text"><%= comment.content %></p>
                        <div class="d-flex justify-content-between align-items-center">
                            <p class="text-muted small mb-0">
                                <strong><%= comment.user.name %></strong> | 
                                <%= comment.created_at.strftime("%Y/%m/%d %H:%M") %>
                            </p>
                            
                            <%# ÂâäÈô§„Éú„Çø„É≥ %>
                            <% if comment.user == current_user %>
                                <%= link_to 'ÂâäÈô§', [@post, comment], method: :delete, 
                                            data: { confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü', remote: true }, 
                                            class: 'btn btn-danger btn-sm' %>
                            <% end %>
                        </div>
                    </div>
                </div>
            <% end %>
        </div>
        
    </div>
</div>