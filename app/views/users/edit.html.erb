<div class="row justify-content-center my-5">
  <div class="col-md-8 col-lg-6"> <%# フォームの幅を少し広げ、デザイン要素を入れるスペースを確保 %>
    <div class="card p-4 p-md-5 shadow-lg border-top border-orange border-3">
      
      <h2 class="text-center mb-4 fw-bold text-orange">
        <i class="fas fa-user-edit me-2"></i>プロフィール編集
      </h2>
      
      <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, multipart: true }) do |f| %> <%# multipart: true を追加 %>
        <%= render "devise/shared/error_messages", resource: resource %>

        <%# ========== 1. アバター画像セクション ========== %>
        <div class="text-center mb-4 border-bottom pb-3">
          <h4 class="fw-bold text-secondary mb-3">
            <i class="fas fa-camera me-2"></i>アバター画像
          </h4>
          
          <%# 現在の画像 or プレースホルダー %>
          <% if resource.avatar.attached? %>
            <%= image_tag resource.avatar, 
                          class: 'rounded-circle mb-2 border border-2 border-secondary', 
                          style: 'width: 100px; height: 100px; object-fit: cover;' %>
          <% else %>
            <div class="rounded-circle mx-auto mb-2 bg-light d-flex align-items-center justify-content-center" style="width: 100px; height: 100px;">
              <i class="fas fa-user-circle fa-4x text-muted"></i>
            </div>
          <% end %>
          
          <%# ファイル選択フィールドをカスタムボタンにする %>
          <div class="mt-2">
            <%= f.label :avatar, class: "btn btn-outline-secondary btn-sm" do %>
              <i class="fas fa-upload me-2"></i> ファイルを選択
              <%= f.file_field :avatar, id: "avatar_field", class: "d-none", accept: "image/*" %>
            <% end %>
            <span id="file-name-display" class="ms-3 small text-muted">
              <%= resource.avatar.attached? ? "選択済み" : "選択されていません" %>
            </span>
          </div>
          
          <%# ファイル名表示用のJavaScript %>
          <script>
            document.getElementById('avatar_field').addEventListener('change', function(e) {
              const fileName = e.target.files[0] ? e.target.files[0].name : '選択されていません';
              document.getElementById('file-name-display').textContent = fileName;
            });
          </script>
        </div>

        <%# ========== 2. ユーザー情報セクション ========== %>
        <h4 class="fw-bold mb-3 mt-4 text-primary"><i class="fas fa-info-circle me-2"></i>基本情報</h4>
        
        <div class="mb-3">
          <%= f.label :name, 'ユーザー名', class: 'form-label' %>
          <%= f.text_field :name, autofocus: true, autocomplete: "name", class: 'form-control' %>
        </div>
        
        <div class="mb-3">
          <%= f.label :description, '自己紹介', class: 'form-label' %> <%# 自己紹介フィールドの追加 %>
          <%= f.text_area :description, rows: 4, placeholder: "あなたのトレーニング歴や目標などを記入してください", class: 'form-control' %>
        </div>
        
        <div class="mb-3">
          <%= f.label :email, 'メールアドレス', class: 'form-label' %>
          <%= f.email_field :email, autocomplete: "email", class: 'form-control' %>
        </div>

        <%# ========== 3. パスワードセクション ========== %>
        <h4 class="fw-bold mb-3 mt-4 text-danger"><i class="fas fa-lock me-2"></i>パスワード変更</h4>
        
        <div class="mb-3">
          <%= f.label :password, '新しいパスワード', class: 'form-label' %> 
          <small class="text-muted d-block">(変更しない場合は空欄にしてください)</small>
          <%= f.password_field :password, autocomplete: "new-password", class: 'form-control' %>
          <small class="text-muted"><%= @minimum_password_length %> characters minimum</small> <%# Deviseの最小文字数表示 %>
        </div>

        <div class="mb-3">
          <%= f.label :password_confirmation, 'パスワード（確認）', class: 'form-label' %>
          <%= f.password_field :password_confirmation, autocomplete: "new-password", class: 'form-control' %>
        </div>

        <div class="mb-3">
          <%= f.label :current_password, '現在のパスワード', class: 'form-label' %> 
          <small class="text-danger d-block">(変更を保存するには**現在のパスワード**が必要です)</small>
          <%= f.password_field :current_password, autocomplete: "current-password", class: 'form-control' %>
        </div>

        <%# ========== 4. 更新ボタン ========== %>
        <div class="actions mt-5">
          <%= f.submit "プロフィールを更新する", class: 'btn btn-orange btn-lg w-100 shadow-lg' %> <%# ブランドカラーと強調 %>
        </div>
      <% end %>
      
      <%# ========== 5. 退会リンク ========== %>
      <hr class="my-5">
      
      <div class="text-center">
        <h4 class="fw-bold text-danger mb-3"><i class="fas fa-trash-alt me-2"></i>アカウントの削除</h4>
        <%= link_to "アカウントを削除/退会する", registration_path(resource_name), 
                    data: { turbo_method: :delete, turbo_confirm: "本当に退会しますか？この操作は元に戻せません。" }, 
                    class: 'btn btn-outline-danger' %>
      </div>
      
    </div>
  </div>
</div>